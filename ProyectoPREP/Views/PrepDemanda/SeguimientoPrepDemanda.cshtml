@model TblPrepDemandaSeguimiento

<div class="form-title">
    <h4>Seguimientos de la PreP</h4>
</div>

<div divinfo="">

    <h5>Información del Paciente</h5>
    <strong>ID PREP:</strong>
    <span>@ViewBag.IdPred</span>
    <br>

    <strong>Paciente PREP:</strong>
    <span id="spPacienteNombre" name="spEsatus">@ViewBag.Nombre</span>
    <br>

</div>



<form id="formularioSeguimiento" asp-action="SeguimientoPrepDemanda" asp-controller="PrepDemanda" method="post">
    <input type="hidden" id="IdDatos" name="IdDatos" value="@ViewBag.IdPaciente" />
    <input name="" id="Sexo" type="hidden" value="@ViewBag.Sexo" />
    <input name="" id="Edad" type="hidden" value="@ViewBag.Edad" />
    <input name="" id="Peso" type="hidden" value="@ViewBag.Peso" />
    <input name="" id="Genero" type="hidden" value="@ViewBag.Genero" />
    <input name="" id="FechaIngresoSai" type="hidden" value="@ViewBag.FechaIngresoSai" />
    <input name="IdPaciente" id="IdPaciente" type="hidden" value="@ViewBag.IdPaciente" />


    <div id="divFormPrEP">
        <div id="divDatosGenerales" style="border: 2px solid #005476; padding: 10px;">

            <table class="table">
                <tbody>

                    <tr style="display:none">
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>

                        <td colspan="1">
                            Fecha de registro de seguimiento:
                            <div class="form-group col-md-8">

                                <input id="FechaSeguimiento" data-val="true" data-val-required="Este campo obligatorio." onkeydown="return false" asp-for="FechaSeguimiento" name="FechaSeguimiento" class="form-control col-sm-3 date" type="date">
                                <span asp-validation-for="FechaSeguimiento" style="color:red;margin-left:20px"></span>

                            </div>

                        </td>


                    </tr>
                    <tr>
                        <td colspan="2">
                            Signos Vitales:
                            <br>
                            <div style="display:flex">

                                <label style="width:26px">TA:</label>
                                <input type="text" asp-for="SignosVitalesTa" style="margin-right:5px" data-val="true" data-val-required="Este campo obligatorio." oninput="this.value = this.value.replace(/[^0-9,/]/,'')" id="SignosVitalesTa" name="SignosVitalesTa" class="form-control2"> mmHg
                                <span asp-validation-for="SignosVitalesTa" style="color:red;margin-left:20px"></span>

                            </div>
                            <br>
                            <div style="display:flex">

                                <label style="width:26px">FC:</label>
                                <input type="text" style="margin-right:5px" id="SignosVitalesFc" asp-for="SignosVitalesFc" data-val="true" data-val-required="Este campo obligatorio." oninput="this.value = this.value.replace(/[^0-9,/]/,'')" name="SignosVitalesFc" class="form-control2"> l/min
                                <span asp-validation-for="SignosVitalesFc" style="color:red;margin-left:30px"></span>

                            </div>
                            <br>
                            <div style="display:flex">

                                <label style="width:26px">FR:</label>

                                <input type="text" style="margin-right:5px" id="SignosVitalesFr" data-val="true" data-val-required="Este campo obligatorio." oninput="this.value = this.value.replace(/[^0-9,/]/,'')" asp-for="SignosVitalesFr" name="SignosVitalesFr" class="form-control2"> r/min
                                <span asp-validation-for="SignosVitalesFr" style="color:red;margin-left:30px"></span>

                            </div>
                        </td>

                        <td colspan="2">
                            Medidas Antropometrícas:
                            <br>
                            <label style="width:50px">Peso:</label>
                            <input style="width:200px; margin-left:50px;" id="Peso" asp-for="Peso" name="Peso" type="number" data-val="true" data-val-required="Este campo obligatorio." min="90" max="350" class="form-control2" placeholder="Introduzca su Peso en Lbs.">
                            <span id="pesoValidationMsg" lang="es-do" style="color:red; margin-left:20px;"></span>

                            <br>
                            <label class="label-width">Talla Pies:</label>
                            <input style="width:200px; margin-left:32px;" id="TallaPies" asp-for="TallaPies" name="TallaPies" data-val="true" data-val-required="Este campo obligatorio." class="form-control2" type="number" min="1" placeholder="Introduzca su Talla en Pies.">
                            <span asp-validation-for="TallaPies" style="color:red; margin-left:20px;"></span>

                            <br>
                            <label class="label-width">Talla Pulgadas:</label>
                            <input style="width:200px; margin-left:-2px" id="TallaPulgadas" asp-for="TallaPulgadas" name="TallaPulgadas" data-val="true" data-val-required="Este campo obligatorio." class="form-control2" type="number" placeholder="Introduzca su Talla en Pulg." min="0" max="12">
                            <span id="tallaPulgadaValidation" lang="es-do" style="color:red; margin-left:20px;"></span>





                        </td>
                    </tr>

                    <tr id="VIHp">

                        <td colspan="2">
                            Fecha de realización(Prueba VIH):
                            <br>
                            <div class="form-group col-md-4">
                                <input id="txtFechaRealizacionPrueba" data-val="true" data-val-required="Este campo obligatorio." onkeydown="return false" asp-for="FechaPruebaVih" name="FechaPruebaVih" class="form-control col-3 date" type="date">
                                <span asp-validation-for="FechaPruebaVih" style="color:red;margin-left:20px"></span>

                            </div>
                        </td>
                        <td colspan="2">
                            Repetición de la Prueba VIH:
                            <br>
                            Resultado:
                            <div class="radio radio-info">
                                <input id="rdVIH1" class="styled" style="margin-left:0px;" data-val="true" data-val-required="Este campo obligatorio." onclick="resultadoVIH(value);" type="radio" asp-for="ResultadoPruebaVih" name="ResultadoPruebaVih" value="Negativo">
                                <label for="rdVIH1">
                                    Negativo.
                                </label>

                            </div>

                            <div class="radio radio-info">
                                <input id="rdVIH2" class="styled" style="margin-left: 0px;" data-val="true" data-val-required="Este campo obligatorio." type="radio" onclick="resultadoVIH(value);" asp-for="ResultadoPruebaVih" name="ResultadoPruebaVih" value="Positivo">
                                <label for="rdVIH2">

                                    Positivo
                                </label>
                            </div>
                            <span asp-validation-for="ResultadoPruebaVih" style="color:red;margin-left:20px"></span>

                        </td>
                    </tr>
                    <tr>
                        <td colspan="1">
                            <label>
                                ¿Se consultó acerca de los signos y síntomas de infección aguda por VIH?
                            </label>
                            <div class="radio radio-info">
                                <input id="chkconsultaVIH1" style="margin-left:0px;" data-val="true" data-val-required="Este campo obligatorio." onclick="tieneSintomas(this.value);" asp-for="ConsultaSignosInfeccion" name="ConsultaSignosInfeccion" class="styled" type="radio" value="Si">
                                <label for="chkconsultaVIH1">
                                    Si
                                </label>
                            </div>
                            <div class="radio radio-info">
                                <input id="chkconsultaVIH2" style="margin-left:0px;" data-val="true" data-val-required="Este campo obligatorio." onclick="tieneSintomas(this.value);" asp-for="ConsultaSignosInfeccion" name="ConsultaSignosInfeccion" class="styled" type="radio" value="No">
                                <label for="chkconsultaVIH2">
                                    No
                                </label>
                            </div>
                            <span asp-validation-for="ConsultaSignosInfeccion" style="color:red;margin-left:20px"></span>

                        </td>
                        <td colspan="1" style="width:310px">
                            <input type="checkbox" id="check1" name="Linfadenopatias" class="chSignos" disabled="disabled" value="true"> Linfadenopatias cervicales e inguinales
                            <br>
                            <input type="checkbox" id="check2" name="FiebreDesconocida" class="chSignos" disabled="disabled" value="true"> Fiebre de origen desconocido
                            <br>
                            <input type="checkbox" id="check3" name="DiarreaProlongada" class="chSignos" disabled="disabled" value="true"> Diarrea prolongada de origen desconocido
                            <br>
                            <input type="checkbox" id="check4" name="ErupcionesPiel" class="chSignos" disabled="disabled" value="true"> Erupciones en la piel
                            <br>
                            <input type="checkbox" id="check5" name="InfeccionesRecurrentes" class="chSignos" disabled="disabled" value="true"> Infecciones Recurrentes
                            <br>
                            <input type="checkbox" id="check6" name="HepatoEsplenomegalia" class="chSignos" disabled="disabled" value="true"> Hepato/esplenomegalia
                            <br>
                        </td>
                        <td colspan="1">
                         
                        </td>
                        <td colspan="1">
                         
                              
                        </td>
                    </tr>

                  @*   <tr>
                        <td colspan="2">
                            <label>¿Desea realizar la prueba de Sifilis?</label>
                            <input onchange="mostrarSifilis();" type="checkbox" id="vihS" />
                        </td>
                    </tr>

                    <tr>
                        <td colspan="2">
                            <label>¿Desea realizar la prueba de Sifilis y Hepatitis?</label>
                            <input onchange="mostrarHepatitis();" type="checkbox" id="vihH" />
                        </td>
                    </tr> *@


                    <tr id="sifilisBC">
                        <td id="sifilis" colspan="1">
                            <div class="form-group">
                                Sifilis(VDRL) Realizada:
                                <input onchange="mostrarSifilis();" type="checkbox" id="vihS" />
                                <br>
                                <input id="rdsifilis1" data-val="true" disabled data-val-required="Este campo obligatorio." class="styled habilitarSifilis" type="radio" name="Sifilis" value="No Reactivo"> No Reactivo
                                <input id="rdsifilis2" data-val="true" disabled data-val-required="Este campo obligatorio." class="styled habilitarSifilis" type="radio" name="Sifilis" value="Reactivo"> Reactivo
                                <br>
                                <span asp-validation-for="Sifilis" style="color:red;margin-left:20px"></span>

                                <input style="width:300px" disabled data-val="true" data-val-required="Este campo obligatorio." id="txtfechasifilis1" onkeydown="return false" asp-for="SifilisFecha" name="SifilisFecha" class="Sifilis habilitarSifilis form-control" type="date" placeholder="Fecha">
                                <span asp-validation-for="SifilisFecha" style="color:red;margin-left:20px"></span>

                            </div>
                        </td>
                        <td id="hepatitisB" colspan="2">
                            HBsAg Realizada:
                            <input onchange="mostrarHepatitis();" type="checkbox" id="vihH" />

                            <br>
                            <input id="rdHBsAg1" disabled data-val="true" data-val-required="Este campo obligatorio." class="styled habilitarSifilisB" type="radio" name="HbsAg" value="Negativo"> Negativo
                            <input id="rdHBsAg2" disabled data-val="true" data-val-required="Este campo obligatorio." class="styled habilitarSifilisB" type="radio" name="HbsAg" value="Positivo"> Positivo
                            <br>
                            <span asp-validation-for="HbsAg" style="color:red;margin-left:20px"></span>

                            <input style="width:300px" disabled data-val="true" data-val-required="Este campo obligatorio." id="txtfechaHBsAg1" onkeydown="return false" asp-for="HbsAgFecha" name="HbsAgFecha" class="habilitarSifilisB form-control" type="date" placeholder="Fecha">
                            <span asp-validation-for="HbsAgFecha" style="color:red;margin-left:20px"></span>


                        </td>

                        <td style="" id="hepatitisC" colspan="1">


                            Hepatitis C Realizada:
                            <input onchange="mostrarHepatitisC();" type="checkbox" id="vihHC" />

                            <br>
                            <input id="rdHepatitis1" data-val="true" disabled data-val-required="Este campo obligatorio." class="styled habilitarSifilisC" type="radio" name="HepatitisC" value="Negativo"> Negativo
                            <input id="rdHepatitis2" data-val="true" disabled data-val-required="Este campo obligatorio." class="styled habilitarSifilisC" type="radio" name="HepatitisC" value="Positivo"> Positivo
                            <br>
                            <span asp-validation-for="HepatitisC" style="color:red;margin-left:20px"></span>

                            <input style="width:300px" data-val="true" disabled data-val-required="Este campo obligatorio." onkeydown="return false" id="txtfechaHepatitis" asp-for="HepatitisCFecha" name="HepatitisCFecha" class="habilitarSifilisC form-control" type="date" placeholder="Fecha">
                            <span asp-validation-for="HepatitisC" style="color:red;margin-left:20px"></span>

                        </td>

                    </tr>
                  
                
                    <tr>
                        <td colspan="1">
                            Repetición de la PrEP prescrita:
                            <br>
                            ARV Prescritos
                            <br>
                            <input type="checkbox" onclick="ARV(this.id);" id="td1" name="PrepArvTdfFtc" value="true">
                            TDF/FTC
                            <br>
                            <input type="checkbox" onclick="ARV(this.id);" id="td2" name="PrepArvTdf3tc" value="true">
                            TDF/3TC
                            <br>
                            <input type="checkbox" onclick="ARV(this.id);" id="td3" name="PrepArvTafFtc" value="true">
                            TAF/FTC
                            <br />
                            <span style="color:red">@TempData["ARV"]</span>

                        </td>
                        <td colspan="2">
                            Meses de prescripción

                            <select id="Meses_prescripcion" data-val="true" data-val-required="Este campo obligatorio." style="width:300px;" asp-for="MesesPrescripcion" name="MesesPrescripcion" class="form-control">
                                <option value="">--Seleccione--</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                            <span asp-validation-for="MesesPrescripcion" style="color:red;margin-left:20px"></span>


                        </td>
                        <td colspan="1">
                       
                        </td>
                    </tr>
                 
                </tbody>
            </table>
        </div>
    </div>
    <br />
    <br />

    <div style="margin-block-end:40px">
        <button type="submit" name="Ejecutar" id="Ejecutar" class="btn btn-primary"><i class="glyphicon glyphicon-saved"></i>Registrar Seguimiento</button>
        <a href="javascript:history.back();" class="btn btn-danger" style="margin-left: 5px;">
            <i class="glyphicon glyphicon-remove"></i> Cancelar
        </a>
    </div>



    <div class="modal" id="vih" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" style="color:red; margin-left: 90px;">
                        ¡ADVERTENCIA!
                    </h5>
                    <button type="button" onclick="cerrarModalVIH();" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p id="cuerpoModalvih" style="text-align:center">La persona registrada no es elegible para PREP porque tiene un resultado VIH+.</p>

                </div>
                <div class="modal-footer">
                    <button type="button" id="btnvih" onclick="VIHPositivo();" class="btn btn-secondary " data-dismiss="modal">Aceptar</button>
                    <button type="button" onclick="cerrarModalVIH();" class="btn btn-danger" data-dismiss="modal">Cancelar</button>
                </div>
            </div>
        </div>
    </div>



    <div class="modal" id="myModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" style="color:red; margin-left: 90px;">
                        Advertencia
                    </h5>
                    <button type="button" onclick="cerrarModal();" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p id="cuerpoModal" style="text-align:center"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" onclick="cerrarModal();" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>



</form>

    


<style>
    input[type=radio] {
        margin-left: 0px
    }

    .styled {
        /* Agrega aquí tu estilo personalizado */
        margin-left: 0px; /* Por ejemplo, margen derecho para separarlos */
    }

    #styled {
        /* Agrega aquí tu estilo personalizado */
        margin-left: 0px; /* Por ejemplo, margen derecho para separarlos */
    }
</style>


@section scripts{

	<script type="text/javascript">


        const VIHPositivo = () => {
            $("#MunicipioResidencia").empty();
            var FechaPruebaVih = document.getElementById("txtFechaRealizacionPrueba").value;
            var FechaSeguimiento = document.getElementById("FechaSeguimiento").value;
            var IdPaciente = document.getElementById("IdPaciente").value;
        


            $.post("@Url.Action("VIHPositivoSeguimiento","PrepDemanda")", {
                IdPaciente: IdPaciente, FechaPruebaVih: FechaPruebaVih, FechaSeguimiento: FechaSeguimiento
            }, function (modelos) {
                console.log(modelos);
              
              //  $("#Ejecutar").attr("disabled", true);
               // $('#vih').modal('show');
                setTimeout(paginaPrincipal, 1000);
            });
        }

        const cerrarModalVIH = () => {

            $('#vih').modal('hide');
        }

        var resultadoVIH = (e) => {
            var valor = e;
            var FechaPruebaVih = document.getElementById("txtFechaRealizacionPrueba").value;
            var FechaSeguimiento = document.getElementById("FechaSeguimiento").value;



            if (valor == "Negativo") {
                $("#chkNoSignos1").removeAttr("disabled");
                $("#chkNoSignos2").removeAttr("disabled");

            }

            if (valor == "Positivo") {
                //$("#cuerpoModal").empty();


                if (FechaPruebaVih == "" || FechaSeguimiento == "") {
                    document.getElementById("cuerpoModalvih").innerHTML = "";
                    document.getElementById("cuerpoModalvih").innerHTML = "Faltan campos por llenar";
                    $("#btnvih").attr("disabled", true);
                    document.getElementById("rdVIH2").checked = false;
                    $('#vih').modal('show');
                    return;
                }
                else {

                    $("#btnvih").removeAttr("disabled");
                    document.getElementById("cuerpoModalvih").innerHTML = "";
                    document.getElementById("cuerpoModalvih").innerHTML = "La persona registrada no es elegible para PREP porque tiene un resultado VIH+.";

                    $('#vih').modal('show');
                    //VIHPositivo();
                    //
                    document.getElementById("rdVIH2").checked = false;
                }

            }

        }

        var mostrarSifilis = () => {
            var vihS = document.getElementById("vihS").checked;

            if (vihS) {
                $(".habilitarSifilis").removeAttr("disabled");
            } else {
                $(".habilitarSifilis").attr("disabled", true);
                $(".habilitarSifilis").prop("checked", false); // Limpiar selección de los radios
                $(".habilitarSifilis[type='date']").val(''); // Limpiar campos de fecha
            }
        }

        var mostrarHepatitis = () => {
            var vihH = document.getElementById("vihH").checked;

            if (vihH) {
                $(".habilitarSifilisB").removeAttr("disabled");
            } else {
                $(".habilitarSifilisB").attr("disabled", true);
                $(".habilitarSifilisB").prop("checked", false); // Limpiar selección de los radios
                $(".habilitarSifilisB[type='date']").val(''); // Limpiar campos de fecha
            }
        }

        var mostrarHepatitisC = () => {
            var vihHC = document.getElementById("vihHC").checked;

            if (vihHC) {
                $(".habilitarSifilisC").removeAttr("disabled");
            } else {
                $(".habilitarSifilisC").attr("disabled", true);
                $(".habilitarSifilisC").prop("checked", false); // Limpiar selección de los radios
                $(".habilitarSifilisC[type='date']").val(''); // Limpiar campos de fecha

            }
        }

        var mostrarVIH = (e) => {

            if (e == "Si") {
                $(".habilitarVIH").removeAttr("disabled");
            } else {
                $(".habilitarVIH").attr("disabled", true);
                $(".habilitarVIH").prop("checked", false); // Limpiar selección de los radios
                $(".habilitarVIH[type='date']").val(''); // Limpiar campos de fecha

            }
        }


        var tieneSintomas = (e) => {
            var valor = e;

            if (valor == "Si") {
                $(".chSignos").removeAttr("disabled");

            }

            if (valor == "No") {
                $(".chSignos").attr("disabled", true);

            }
        }
       
        function cerrarModalMenor() {
            $('#menor').modal('hide'); // Cierra el modal
        }


        const menorCreatina = () => {
            var creatina = document.getElementById("ResultadoCreatinina").value;

            if (creatina < 60) {
                $('#menor').modal('show');


            } else {
                document.getElementById("chkaclaramiento2").checked = true;
            }
        }


        const calcularCreatinina = () => {
            var KG = 2.205;
            var Edad = document.getElementById("Edad").value;
            var Peso = document.getElementById("Peso").value;
            var sexo = document.getElementById("Sexo").value;
            var genero = document.getElementById("Genero").value;
            var chkHormonal = document.getElementById("chkHormonal").checked;
            var PesoKG = Peso / KG;

            var valorCreatinina = document.getElementById("CreatininaValor").value;

            if (genero == "3" && chkHormonal == true) {
                var Resultado = ((140 - Edad) * PesoKG * 0.85) / (72 * valorCreatinina);
                document.getElementById("ResultadoCreatinina").value = Resultado.toFixed(3);
                setTimeout(menorCreatina, 1000);

            }
            if (genero == "1") {

                var Resultado = ((140 - Edad) * PesoKG) / (72 * valorCreatinina);
                document.getElementById("ResultadoCreatinina").value = Resultado.toFixed(3);

            }


            if (genero == "2") {
                var Resultado = ((140 - Edad) * PesoKG * 0.85) / (72 * valorCreatinina);
                document.getElementById("ResultadoCreatinina").value = Resultado.toFixed(3);

            }
            if (genero == "3" && chkHormonal == false) {

                var Resultado = ((140 - Edad) * PesoKG) / (72 * valorCreatinina);
                document.getElementById("ResultadoCreatinina").value = Resultado.toFixed(3);
            }

            if (sexo == "M" && genero == "4") {

                var Resultado = ((140 - Edad) * PesoKG) / (72 * valorCreatinina);
                document.getElementById("ResultadoCreatinina").value = Resultado.toFixed(3);

            }

            if (sexo == "F" && genero == "4") {

                var Resultado = ((140 - Edad) * PesoKG) / (72 * valorCreatinina);
                document.getElementById("ResultadoCreatinina").value = Resultado.toFixed(3);

            }
            // Hombres:[140-(edad) x Peso(Kg)]/[72 x Creatinina plasmatica]
            // Mujeres:[140-(edad) x Peso(Kg) x 0.85]/[72 x Creatinina plasmatica]
            setTimeout(menorCreatina, 1000);
        }

        var ARV = (e) => {
            var td1 = document.getElementById("td1").checked;
            var td2 = document.getElementById("td2").checked;
            var td3 = document.getElementById("td3").checked;

            if (e == "td1") {
                document.getElementById("td2").checked = false;
                document.getElementById("td3").checked = false;

            }
            if (e == "td2") {
                document.getElementById("td1").checked = false;
                document.getElementById("td3").checked = false;

            }
            if (e == "td3") {
                document.getElementById("td1").checked = false;
                document.getElementById("td2").checked = false;

            }
        }

        const paginaPrincipal = () => {
            var local = window.location.host;
            console.log(local);
            var origin = "/PrepDemanda/HomePrepDemanda";
            window.location.href = "https://" + local + origin;
        }

    </script>
}

